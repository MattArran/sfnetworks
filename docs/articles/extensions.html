<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extending the vocabulary • sfnetworks</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extending the vocabulary">
<meta property="og:description" content="sfnetworks">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sfnetworks</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/extensions.html">Extending the vocabulary</a>
    </li>
    <li>
      <a href="../articles/intro.html">Tidy Geospatial Networks in R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/luukvdmeer/sfnetworks/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="extensions_files/header-attrs-2.2/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extending the vocabulary</h1>
            
            <h4 class="date">2020-06-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/luukvdmeer/sfnetworks/blob/master/vignettes/extensions.Rmd"><code>vignettes/extensions.Rmd</code></a></small>
      <div class="hidden name"><code>extensions.Rmd</code></div>

    </div>

    
    
<style type="text/css" scoped>
PRE.fansi SPAN {padding-top: .25em; padding-bottom: .25em};
</style>
<p>The core of the package is a data structure that can be provided directly to both graph analytical functions of <code>tidygraph</code> and spatial analytical functions of <code>sf</code>. However, there might be problems that are so specific to spatial networks, that they can neither be solved by <code>tidygraph</code> nor <code>sf</code>. Therefore, <code>sfnetworks</code> contains several extensions to the current offer of the two “parent packages”. We want to prevent that <code>sfnetworks</code> goes too much into a single application - it should remain a lower-level package - but basic, widely used spatial network operations should be supported. The ones that are currently supported are presented in this vignette.</p>
<div id="spatial-graph-node-and-edge-information" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-graph-node-and-edge-information" class="anchor"></a>Spatial graph, node and edge information</h2>
<p>The <code>tidygraph</code> package has a very organized structure, in which it offers a wide range of algorithms for extracting information about either the graph itself, its nodes, or its edges. Think for example about centrality measures (e.g. <code>centrality_betweenness</code>), other node, edge or graph measures (e.g. <code>node_eccentricity</code>, <code>graph_diameter</code>) and node, edge or graph type queries (e.g. <code>node_is_center</code>, <code>edge_is_loop</code>, <code>graph_is_connected</code>).</p>
<p>The <code>sfnetworks</code> package extends this ecosystem by adding specific spatial algorithms. In the current state, the offer contains three spatial edge measures:</p>
<ul>
<li>
<code>edge_length</code>: The length of an edge linestring geometry as calculated by <code>st_length</code>.</li>
<li>
<code>edge_straight_length</code>: The straight-line distance (i.e. euclidean distance for projected coordinates, and great-circle-distance for geographic coordinates) between the two boundary nodes of an edge, as calculated by <code>st_distance</code>.</li>
<li>
<code>edge_circuity</code>: The ratio of the length of an edge linestring geometry versus the straight-line distance between its boundary nodes, as described in <a href="https://journals.sagepub.com/doi/10.1068/b130131p">Giacomin &amp; Levinson, 2015</a>.</li>
</ul>
<p>Just as with all tidygraph algorithms, spatial edge measures are meant to be called inside <code>tidygraph</code> verbs such as <code><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">mutate()</a></code>, where the graph that is currently being worked on is known and thus not needed as an argument to the function.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sfnetworks</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sf</span>)
<span class="co">#&gt; Warning: package 'sf' was built under R version 4.0.2</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidygraph</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">net</span> <span class="kw">=</span> <span class="fu"><a href="../reference/as_sfnetwork.html">as_sfnetwork</a></span>(<span class="no">roxel</span>, <span class="kw">directed</span> <span class="kw">=</span> <span class="fl">FALSE</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="fl">3035</span>)

<span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">mutate</a></span>(
    <span class="kw">length</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_length</a></span>(),
    <span class="kw">straight</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_straight_length</a></span>(),
    <span class="kw">circuity</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_circuity</a></span>()
  ) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">select</a></span>(<span class="no">length</span>, <span class="no">straight</span>, <span class="no">circuity</span>)</pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 6 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to                                geometry   length straight circuity
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>                        </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>      </span><span style="color: #555555;">[m]</span><span>      </span><span style="color: #555555;">[1]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2      (4151491 3207923, 4151474 3207946)  28.859~  28.859~ 1.000000
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 (4151398 3207777, 4151390 3207727, 415~ 107.714~ 107.082~ 1.005894
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 (4151408 3207539, 4151417 3207573, 415~  54.367~  54.341~ 1.000471
#&gt; </span><span style="color: #555555;">4</span><span>     7     8 (4151885 3206698, 4151861 3206711, 415~ 155.223~ 153.908~ 1.008540
#&gt; </span><span style="color: #555555;">5</span><span>     9    10      (4151732 3207017, 4151721 3206809) 208.682~ 208.682~ 1.000000
#&gt; </span><span style="color: #555555;">6</span><span>    11    12 (4152152 3206984, 4152143 3206932, 415~  63.028~  61.708~ 1.021397
#&gt; </span><span style="color: #555555;"># ... with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 1</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)
#&gt; </span><span style="color: #555555;"># ... with 698 more rows</span><span>
</span></code></pre>
<p>If you want to use an algorithm outside of a verb you can use <code><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html">with_graph()</a></code> to set the graph context temporarily.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">circuities</span> <span class="kw">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/with_graph.html">with_graph</a></span>(<span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="no">net</span>, <span class="st">"edges"</span>), <span class="fu"><a href="../reference/spatial_edge_measures.html">edge_circuity</a></span>())
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">circuities</span>)
<span class="co">#&gt; Units: [1]</span>
<span class="co">#&gt; [1] 1.000000 1.005894 1.000471 1.008540 1.000000 1.021397</span></pre></body></html></div>
</div>
<div id="spatial-shortest-paths" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-shortest-paths" class="anchor"></a>Spatial shortest paths</h2>
<p><code>sfnetworks</code> also offers spatial wrappers around the shortest path calculation functionalities from <code>igraph</code>. The spatial wrappers all start with <code>st_</code>, just as the spatial analytical functions from the <code>sf</code> packages. Instead of providing the node indices of the <code>from</code> and <code>to</code> nodes of the shortest path, it is possible to provide sf-formatted points in geographical space instead.</p>
<p>Providing node indices:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/spatial_shortest_paths.html">st_shortest_paths</a></span>(<span class="no">net</span>, <span class="fl">1</span>, <span class="fl">9</span>)$<span class="no">vpath</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; + 17/701 vertices, from edb068c:</span>
<span class="co">#&gt;  [1]   1 644 579 260 164 208 426 424 533 657 512 506 111 524 292 167   9</span></pre></body></html></div>
<p>Providing the same nodes as spatial points instead:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">p1</span> <span class="kw">=</span> <span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="st">"nodes"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">slice</a></span>(<span class="fl">1</span>)

<span class="no">p1</span></pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; Simple feature collection with 1 feature and 0 fields
#&gt; geometry type:  POINT
#&gt; dimension:      XY
#&gt; bbox:           xmin: 4151491 ymin: 3207923 xmax: 4151491 ymax: 3207923
#&gt; projected CRS:  ETRS89-extended / LAEA Europe
#&gt; <span style="color: #555555;"># A tibble: 1 x 1</span><span>
#&gt;            geometry
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)
</span></code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r">
<span class="no">p2</span> <span class="kw">=</span> <span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="st">"nodes"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">slice</a></span>(<span class="fl">9</span>)

<span class="no">p2</span></pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; Simple feature collection with 1 feature and 0 fields
#&gt; geometry type:  POINT
#&gt; dimension:      XY
#&gt; bbox:           xmin: 4151732 ymin: 3207017 xmax: 4151732 ymax: 3207017
#&gt; projected CRS:  ETRS89-extended / LAEA Europe
#&gt; <span style="color: #555555;"># A tibble: 1 x 1</span><span>
#&gt;            geometry
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151732 3207017)
</span></code></pre>
<div class="sourceCode" id="cb7"><html><body><pre class="r">
<span class="fu"><a href="../reference/spatial_shortest_paths.html">st_shortest_paths</a></span>(<span class="no">net</span>, <span class="no">p1</span>, <span class="no">p2</span>)$<span class="no">vpath</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; + 17/701 vertices, from edb068c:</span>
<span class="co">#&gt;  [1]   1 644 579 260 164 208 426 424 533 657 512 506 111 524 292 167   9</span></pre></body></html></div>
<p>In the case above, the locations of these spatial points are exactly equal to the locations of nodes in the network. However, they don’t have to be. Points that don’t lie on the network will be replaced by their nearest node.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">p3</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">p1</span>)<span class="kw">[[</span><span class="fl">1</span>]] + <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">500</span>, <span class="fl">500</span>)),
  <span class="kw">crs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="no">p1</span>)
)

<span class="no">p4</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">p2</span>)<span class="kw">[[</span><span class="fl">1</span>]] + <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">500</span>, -<span class="fl">500</span>)),
  <span class="kw">crs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_crs.html">st_crs</a></span>(<span class="no">p2</span>)
)

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="kw">mar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>))
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="no">net</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="no">p3</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="no">p4</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">20</span>, <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="extensions_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r">
<span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_binary_pred.html">st_intersects</a></span>(<span class="no">p3</span>, <span class="no">net</span>)) <span class="kw">&gt;</span> <span class="fl">0</span>
<span class="co">#&gt; [1] FALSE</span>

<span class="fu"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_binary_pred.html">st_intersects</a></span>(<span class="no">p4</span>, <span class="no">net</span>)) <span class="kw">&gt;</span> <span class="fl">0</span>
<span class="co">#&gt; [1] FALSE</span>

<span class="fu"><a href="../reference/spatial_shortest_paths.html">st_shortest_paths</a></span>(<span class="no">net</span>, <span class="no">p3</span>, <span class="no">p4</span>)$<span class="no">vpath</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; + 36/701 vertices, from edb068c:</span>
<span class="co">#&gt;  [1] 178 179 601 121 120 700 691 635 636 588 260 164 208 426 424 533 657 512 506</span>
<span class="co">#&gt; [20] 111 524 292 167   9  10 168 496 495 485 162 628 242 493 240 157 158</span></pre></body></html></div>
<p>All paths above are calculated without taking into account weights of edges. Just as in <code><a href="https://rdrr.io/pkg/igraph/man/distances.html">igraph::shortest_paths</a></code>, you can provide such weights through the weights argument. However, in <code>st_shortest_path</code> you also have the option to just provide a column name to the weights argument, which should match an existing column in the networks edges table, whose values will then be used as weights.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">net</span>  <span class="kw">=</span> <span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="no">edges</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">mutate</a></span>(<span class="kw">length</span> <span class="kw">=</span> <span class="kw pkg">sf</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_length</a></span>(<span class="no">.</span>))

<span class="no">net</span></pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 6 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name       type                                  geometry   length
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>      </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                         </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbeck~ reside~     (4151491 3207923, 4151474 3207946)  28.859~
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersal~ second~ (4151398 3207777, 4151390 3207727, 41~ 107.714~
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-B~ reside~ (4151408 3207539, 4151417 3207573, 41~  54.367~
#&gt; </span><span style="color: #555555;">4</span><span>     7     8 </span><span style="color: #BB0000;">NA</span><span>         path    (4151885 3206698, 4151861 3206711, 41~ 155.223~
#&gt; </span><span style="color: #555555;">5</span><span>     9    10 Welsinghe~ reside~     (4151732 3207017, 4151721 3206809) 208.682~
#&gt; </span><span style="color: #555555;">6</span><span>    11    12 </span><span style="color: #BB0000;">NA</span><span>         footway (4152152 3206984, 4152143 3206932, 41~  63.028~
#&gt; </span><span style="color: #555555;"># ... with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 1</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)
#&gt; </span><span style="color: #555555;"># ... with 698 more rows</span><span>
</span></code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r">
<span class="fu"><a href="../reference/spatial_shortest_paths.html">st_shortest_paths</a></span>(<span class="no">net</span>, <span class="no">p1</span>, <span class="no">p2</span>, <span class="kw">weights</span> <span class="kw">=</span> <span class="st">"length"</span>)$<span class="no">vpath</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; + 17/701 vertices, from edb068c:</span>
<span class="co">#&gt;  [1]   1 645 481 263 164 208 426 424 533 657 512 506 111 524 292 167   9</span></pre></body></html></div>
<p>Alternatively, you can name your weights column weight. That is the same as having a weight attribute in an <code>igraph</code> object. The weight values will then be automatically detected and do not have to be provided explicitly.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">net</span>  <span class="kw">=</span> <span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">rename</a></span>(<span class="kw">weight</span> <span class="kw">=</span> <span class="no">length</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="st">"nodes"</span>)

<span class="fu"><a href="../reference/spatial_shortest_paths.html">st_shortest_paths</a></span>(<span class="no">net</span>, <span class="no">p1</span>, <span class="no">p2</span>)$<span class="no">vpath</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; + 17/701 vertices, from edb068c:</span>
<span class="co">#&gt;  [1]   1 645 481 263 164 208 426 424 533 657 512 506 111 524 292 167   9</span></pre></body></html></div>
<p>We now showed 1-to-1 shortest paths. You can also calculate 1-to-many shortest paths, by giving a multiple feature <code>sf</code> or <code>sfc</code> object as <code>to</code> argument. Having multiple features as <code>from</code> argument is not possible in this case (since <code>igraph</code> does not support it).</p>
<p>Having multiple features as <code>from</code> argument ìs possible in <code><a href="../reference/spatial_shortest_paths.html">st_network_distance()</a></code>, which is a wrapper around <code><a href="https://rdrr.io/pkg/igraph/man/distances.html">igraph::distances</a></code>. This returns a distance matrix.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">ps1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">p1</span>), <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(<span class="no">p3</span>))

<span class="no">ps1</span>
<span class="co">#&gt; Geometry set for 2 features </span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 4151491 ymin: 3207923 xmax: 4151991 ymax: 3208423</span>
<span class="co">#&gt; projected CRS:  ETRS89-extended / LAEA Europe</span>
<span class="co">#&gt; POINT (4151491 3207923)</span>
<span class="co">#&gt; POINT (4151991 3208423)</span>

<span class="no">ps2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="no">p2</span>), <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(<span class="no">p4</span>))

<span class="no">ps2</span>
<span class="co">#&gt; Geometry set for 2 features </span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 4151232 ymin: 3206517 xmax: 4151732 ymax: 3207017</span>
<span class="co">#&gt; projected CRS:  ETRS89-extended / LAEA Europe</span>
<span class="co">#&gt; POINT (4151732 3207017)</span>
<span class="co">#&gt; POINT (4151232 3206517)</span>

<span class="co"># Note that our net object now has a weight column which will be automatically used.</span>
<span class="fu"><a href="../reference/spatial_shortest_paths.html">st_network_distance</a></span>(<span class="no">net</span>, <span class="no">ps1</span>, <span class="no">ps2</span>)
<span class="co">#&gt;          [,1]     [,2]</span>
<span class="co">#&gt; [1,] 1040.299 1948.543</span>
<span class="co">#&gt; [2,] 1763.122 2792.150</span></pre></body></html></div>
<p>Finally, there is also <code><a href="../reference/spatial_shortest_paths.html">st_all_shortest_paths()</a></code>, which is a wrapper around <code><a href="https://rdrr.io/pkg/igraph/man/distances.html">igraph::all_shortest_paths</a></code>. It works the same as <code><a href="../reference/spatial_shortest_paths.html">st_shortest_paths()</a></code>, but in case there are multiple shortest paths from A to B, it will return all of them, instead of only one.</p>
<p><em>Note: if you provide points that are not network nodes, the nearest node to those points will be taken. We would like to also give the option to take the nearest point on the nearest edge. See <a href="https://github.com/luukvdmeer/sfnetworks/issues/54">here</a></em></p>
</div>
<div id="spatial-morphers" class="section level2">
<h2 class="hasAnchor">
<a href="#spatial-morphers" class="anchor"></a>Spatial morphers</h2>
<p>Before we get to the spatial morphing extensions, we need to shortly introduce the concept. Morphing is a <code>tidygraph</code> functionality to morph a graph into a different representation. Then, any of the supported <code>dplyr</code> verbs can be applied to this morphed graph (which sub-classes a <code>list</code>), and changes to the data are merged back into the original graph when calling <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph()</a></code>. A “different representation of a graph” sounds like a broad term, and it is! A large amount of morphing functions are offered by <code>tidygraph</code>, and they all work on <code>sfnetwork</code> objects as well. See the <a href="https://tidygraph.data-imaginist.com/index.html">tidygraph documentation</a> for an overview of all of them, and more details on the morphing concept.</p>
<p>Lets look at an example, in which we morph a graph into a representation where all its components are a graph on its own, combined together in a list structure. Since <code>net</code> has 14 components, the morphed representation is a list with 14 elements.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co"># Mutate will be applied to each component separately.</span>
<span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span>(<span class="no">to_components</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">mutate</a></span>(<span class="kw">is_comp_center</span> <span class="kw">=</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/node_types.html">node_is_center</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">unmorph</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/reexports.html">filter</a></span>(<span class="no">is_comp_center</span>)</pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">27</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">13</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An unrooted forest with 14 trees with spatially explicit edges
#&gt; #
#&gt; # Node Data:     27 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150894 ymin: 3206493 xmax: 4152033 ymax: 3208245</span><span>
#&gt;            geometry is_comp_center
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;lgl&gt;</span><span>         
#&gt; </span><span style="color: #555555;">1</span><span> (4150894 3207618) TRUE          
#&gt; </span><span style="color: #555555;">2</span><span> (4150900 3207592) TRUE          
#&gt; </span><span style="color: #555555;">3</span><span> (4151123 3206503) TRUE          
#&gt; </span><span style="color: #555555;">4</span><span> (4151065 3206493) TRUE          
#&gt; </span><span style="color: #555555;">5</span><span> (4151970 3207214) TRUE          
#&gt; </span><span style="color: #555555;">6</span><span> (4151986 3207186) TRUE          
#&gt; </span><span style="color: #555555;"># ... with 21 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     13 x 6</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150894 ymin: 3206493 xmax: 4152033 ymax: 3208245</span><span>
#&gt;    from    to name            type                             geometry   weight
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>           </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                    </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Stellmacherweg  resident~ (4150894 3207618, 4150900 3207~ 26.62661
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Lise-Meitner-S~ resident~ (4151123 3206503, 4151065 3206~ 58.68811
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 </span><span style="color: #BB0000;">NA</span><span>              service   (4151970 3207214, 4151986 3207~ 32.03462
#&gt; </span><span style="color: #555555;"># ... with 10 more rows</span><span>
</span></code></pre>
<p>The <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">crystallise()</a></code> verb will turn a morphed graph into a tibble, where each row represents one of the elements of the list, which the corresponding graph object stored in a column named <code>graph</code>. Alternatively, the <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert()</a></code> verb takes one element of the list, and returns the graph stored in that element. For example, <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert(net, to_components, .select = 1)</a></code> will convert the first (and largest) component of our network. A lot of morphers create a list with only a single element. In that case, the <code>.select</code> argument of <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert()</a></code> can be left out, since the only graph of the morphed representation will always be returned.</p>
<p>Now, lets move on to the spatial morphers, that <code>sfnetworks</code> adds to the exsting set of tidygraphs offer. All spatial morpher functions start with <code>to_spatial_</code>, to distinguish them for the others. Just as in <code>tidygraph</code>, morphers are only meant to be called inside either <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph()</a></code> or <code><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert()</a></code> verbs, and not to be applied to the graph directly.</p>
<p>The following spatial morphers are currently offered by <code>sfnetwork</code>:</p>
<p><code>to_spatial_coordinates</code> drops the geometry list column of the edges (if present), and represents the node geometries with an <code>X</code> and <code>Y</code> column, instead of a geometry list column.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_coordinates</span>)</pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># A tbl_graph: 701 nodes and 851 edges
#&gt; #
#&gt; # An undirected multigraph with 14 components
#&gt; #
#&gt; # Node Data: 701 x 3 (active)</span><span>
#&gt;   .tidygraph_node_index        X        Y
#&gt;                   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>    </span><span style="color: #555555;font-style: italic;">&lt;dbl&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>                     1 4</span><span style="text-decoration: underline;">151</span><span>491. 3</span><span style="text-decoration: underline;">207</span><span>923.
#&gt; </span><span style="color: #555555;">2</span><span>                     2 4</span><span style="text-decoration: underline;">151</span><span>474. 3</span><span style="text-decoration: underline;">207</span><span>946.
#&gt; </span><span style="color: #555555;">3</span><span>                     3 4</span><span style="text-decoration: underline;">151</span><span>398. 3</span><span style="text-decoration: underline;">207</span><span>777.
#&gt; </span><span style="color: #555555;">4</span><span>                     4 4</span><span style="text-decoration: underline;">151</span><span>370. 3</span><span style="text-decoration: underline;">207</span><span>673.
#&gt; </span><span style="color: #555555;">5</span><span>                     5 4</span><span style="text-decoration: underline;">151</span><span>408. 3</span><span style="text-decoration: underline;">207</span><span>539.
#&gt; </span><span style="color: #555555;">6</span><span>                     6 4</span><span style="text-decoration: underline;">151</span><span>421. 3</span><span style="text-decoration: underline;">207</span><span>592.
#&gt; </span><span style="color: #555555;"># ... with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data: 851 x 6</span><span>
#&gt;    from    to name                  type           weight .tidygraph_edge_index
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>             </span><span style="color: #555555;">[m]</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker Strasse   residential  28.85977                     1
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee          secondary   107.71403                     2
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd-Strasse residential  54.36729                     3
#&gt; </span><span style="color: #555555;"># ... with 848 more rows</span><span>
</span></code></pre>
<p><code>to_spatial_dense_graph</code> reconstruct the network by using all edge linestring points as nodes, instead of only the endpoints.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="no">net</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">net</span>, <span class="no">to_spatial_dense_graph</span>))
<span class="co">#&gt; Warning in st_cast.sf(edges, "POINT"): repeating attributes for all sub-</span>
<span class="co">#&gt; geometries for which they may not be constant</span></pre></body></html></div>
<p><img src="extensions_files/figure-html/unnamed-chunk-12-1.png" width="700"><img src="extensions_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
<p><code>to_spatial_directed</code> makes a graph directed in the direction given by the linestring geometries of the edges. This in contradiction to the <code>to_directed</code> morpher of <code>tidygraph</code>, which makes a graph directed in the direction given by the <code>to</code> and <code>from</code> column.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_unary.html">st_reverse</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_directed</span>)
<span class="co">#&gt; Warning in st_reverse.sfnetwork(.): For undirected networks st_reverse has no</span>
<span class="co">#&gt; effect on columns 'to' and 'from'</span></pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # A directed multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Edge Data:     851 x 7 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name   type                     geometry   weight .tidygraph_edge~
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>            </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>            </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     2     1 Havix~ resid~ (4151474 3207946, 4151491~  28.859~                1
#&gt; </span><span style="color: #555555;">2</span><span>     4     3 Piene~ secon~ (4151370 3207673, 4151390~ 107.714~                2
#&gt; </span><span style="color: #555555;">3</span><span>     6     5 Schul~ resid~ (4151421 3207592, 4151417~  54.367~                3
#&gt; </span><span style="color: #555555;">4</span><span>     8     7 </span><span style="color: #BB0000;">NA</span><span>     path   (4151762 3206789, 4151771~ 155.223~                4
#&gt; </span><span style="color: #555555;">5</span><span>    10     9 Welsi~ resid~ (4151721 3206809, 4151732~ 208.682~                5
#&gt; </span><span style="color: #555555;">6</span><span>    12    11 </span><span style="color: #BB0000;">NA</span><span>     footw~ (4152147 3206923, 4152143~  63.028~                6
#&gt; </span><span style="color: #555555;"># ... with 845 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Node Data:     701 x 2</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry .tidygraph_node_index
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)                     1
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)                     2
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)                     3
#&gt; </span><span style="color: #555555;"># ... with 698 more rows</span><span>
</span></code></pre>
<p><code>to_spatial_implicit_edges</code> drops the geometries of spatially explicit edges.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_implicit_edges</span>)</pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially implicit edges
#&gt; #
#&gt; # Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry .tidygraph_node_index
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)                     1
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)                     2
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)                     3
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)                     4
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)                     5
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)                     6
#&gt; </span><span style="color: #555555;"># ... with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data: 851 x 6</span><span>
#&gt;    from    to name                  type           weight .tidygraph_edge_index
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>             </span><span style="color: #555555;">[m]</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixbecker Strasse   residential  28.85977                     1
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Pienersallee          secondary   107.71403                     2
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schulte-Bernd-Strasse residential  54.36729                     3
#&gt; </span><span style="color: #555555;"># ... with 848 more rows</span><span>
</span></code></pre>
<p><code>to_spatial_explicit_edges</code> draws straight linestring geometries between the <code>to</code> and <code>from</code> nodes of spatially implicit edges.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_implicit_edges</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_explicit_edges</span>)</pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">701</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">851</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected multigraph with 14 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     701 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;            geometry .tidygraph_node_index
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)                     1
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)                     2
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)                     3
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)                     4
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)                     5
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)                     6
#&gt; </span><span style="color: #555555;"># ... with 695 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     851 x 7</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150707 ymin: 3206375 xmax: 4152367 ymax: 3208565</span><span>
#&gt;    from    to name    type     weight .tidygraph_edge~                  geometry
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>   </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>       </span><span style="color: #555555;">[m]</span><span>            </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>          </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havixb~ resid~  28.859~                1 (4151491 3207923, 415147~
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Piener~ secon~ 107.714~                2 (4151398 3207777, 415137~
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schult~ resid~  54.367~                3 (4151408 3207539, 415142~
#&gt; </span><span style="color: #555555;"># ... with 848 more rows</span><span>
</span></code></pre>
<p><code>to_spatial_subgraph</code> limits a graph to a single spatial subset. … is evaluated in the same manner as <code>st_filter</code>.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">e1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53173</span>, <span class="fl">51.95662</span>))
<span class="no">e2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53173</span>, <span class="fl">51.95190</span>))
<span class="no">e3</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53778</span>, <span class="fl">51.95190</span>))
<span class="no">e4</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_point</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">7.53778</span>, <span class="fl">51.95662</span>))

<span class="no">rect</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st.html">st_multipoint</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">e1</span>, <span class="no">e2</span>, <span class="no">e3</span>, <span class="no">e4</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_cast.html">st_cast</a></span>(<span class="st">'POLYGON'</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/sfc.html">st_sfc</a></span>(<span class="kw">crs</span> <span class="kw">=</span> <span class="fl">4326</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_transform.html">st_transform</a></span>(<span class="fl">3035</span>)

<span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_subgraph</span>, <span class="no">rect</span>, <span class="kw">.predicate</span> <span class="kw">=</span> <span class="no">st_intersects</span>)
<span class="co">#&gt; Subsetting by nodes</span></pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">89</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">104</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An undirected simple graph with 8 components with spatially explicit edges
#&gt; #
#&gt; # Node Data:     89 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4151344 ymin: 3207528 xmax: 4151757 ymax: 3208041</span><span>
#&gt;            geometry .tidygraph_node_index
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151491 3207923)                     1
#&gt; </span><span style="color: #555555;">2</span><span> (4151474 3207946)                     2
#&gt; </span><span style="color: #555555;">3</span><span> (4151398 3207777)                     3
#&gt; </span><span style="color: #555555;">4</span><span> (4151370 3207673)                     4
#&gt; </span><span style="color: #555555;">5</span><span> (4151408 3207539)                     5
#&gt; </span><span style="color: #555555;">6</span><span> (4151421 3207592)                     6
#&gt; </span><span style="color: #555555;"># ... with 83 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     104 x 7</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4151348 ymin: 3207539 xmax: 4151757 ymax: 3208041</span><span>
#&gt;    from    to name   type                     geometry   weight .tidygraph_edge~
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>            </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>            </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Havix~ resid~ (4151491 3207923, 4151474~  28.859~                1
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Piene~ secon~ (4151398 3207777, 4151390~ 107.714~                2
#&gt; </span><span style="color: #555555;">3</span><span>     5     6 Schul~ resid~ (4151408 3207539, 4151417~  54.367~                3
#&gt; </span><span style="color: #555555;"># ... with 101 more rows</span><span>
</span></code></pre>
<p><code>to_spatial_shortest_paths</code> limits a graph to those nodes and edges that are part of the shortest path between two nodes. If multiple <code>to</code> nodes are given, multiple shortest path graphs are returned.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_shortest_paths</span>, <span class="no">p3</span>, <span class="no">p4</span>)</pre></body></html></div>
<pre class="fansi fansi-output"><code>#&gt; <span style="color: #555555;"># An sfnetwork with</span><span> </span><span style="color: #555555;">45</span><span> </span><span style="color: #555555;">nodes and</span><span> </span><span style="color: #555555;">44</span><span> </span><span style="color: #555555;">edges
#&gt; #
#&gt; # CRS: </span><span> </span><span style="color: #555555;">EPSG:3035</span><span> </span><span style="color: #555555;">
#&gt; #
#&gt; # An unrooted tree with spatially explicit edges
#&gt; #
#&gt; # Node Data:     45 x 2 (active)</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: POINT</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150901 ymin: 3206483 xmax: 4152196 ymax: 3208337</span><span>
#&gt;            geometry .tidygraph_node_index
#&gt;         </span><span style="color: #555555;font-style: italic;">&lt;POINT [m]&gt;</span><span>                 </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span> (4151398 3207777)                     3
#&gt; </span><span style="color: #555555;">2</span><span> (4151370 3207673)                     4
#&gt; </span><span style="color: #555555;">3</span><span> (4151845 3208048)                    28
#&gt; </span><span style="color: #555555;">4</span><span> (4151929 3208104)                    29
#&gt; </span><span style="color: #555555;">5</span><span> (4151317 3207574)                    63
#&gt; </span><span style="color: #555555;">6</span><span> (4151063 3207188)                    67
#&gt; </span><span style="color: #555555;"># ... with 39 more rows</span><span>
#&gt; </span><span style="color: #555555;">#
#&gt; # Edge Data:     44 x 7</span><span>
#&gt; </span><span style="color: #555555;"># Geometry type: LINESTRING</span><span>
#&gt; </span><span style="color: #555555;"># Dimension:     XY</span><span>
#&gt; </span><span style="color: #555555;"># Bounding box:  xmin: 4150901 ymin: 3206483 xmax: 4152196 ymax: 3208337</span><span>
#&gt;    from    to name   type                     geometry   weight .tidygraph_edge~
#&gt;   </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>  </span><span style="color: #555555;font-style: italic;">&lt;fct&gt;</span><span>            </span><span style="color: #555555;font-style: italic;">&lt;LINESTRING [m]&gt;</span><span>      </span><span style="color: #555555;">[m]</span><span>            </span><span style="color: #555555;font-style: italic;">&lt;int&gt;</span><span>
#&gt; </span><span style="color: #555555;">1</span><span>     1     2 Piene~ secon~ (4151398 3207777, 4151390~ 107.7140                2
#&gt; </span><span style="color: #555555;">2</span><span>     3     4 Brede~ resid~ (4151845 3208048, 4151929~ 100.6086               16
#&gt; </span><span style="color: #555555;">3</span><span>     4     8 Brede~ resid~ (4152058 3208166, 4152050~ 143.4495               74
#&gt; </span><span style="color: #555555;"># ... with 41 more rows</span><span>
</span></code></pre>
<p>This morpher can be very useful for plotting shortest paths on top of the original graph.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="no">net</span>)
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(
  <span class="no">net</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">convert</a></span>(<span class="no">to_spatial_shortest_paths</span>, <span class="no">p3</span>, <span class="no">p4</span>),
  <span class="kw">col</span> <span class="kw">=</span> <span class="st">"red"</span>,
  <span class="kw">add</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)</pre></body></html></div>
<p><img src="extensions_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>Or, for calculating the lengths of multiple shortest paths.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">net</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/activate.html">activate</a></span>(<span class="st">"edges"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidygraph.data-imaginist.com/reference/morph.html">morph</a></span>(<span class="no">to_spatial_shortest_paths</span>, <span class="no">p1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">p3</span>, <span class="no">p4</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_length</a></span>(<span class="no">x</span>)))
<span class="co">#&gt; [1] 1042.440 1948.543</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lucas van der Meer, Lorena Abad, Andrea Gilardi, Robin Lovelace.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
